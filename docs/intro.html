<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Exploring Spatio Temporal Data | Spatio Temporal Statistics</title>
  <meta name="description" content="This is a gitbook for spatio temporal analysis." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Exploring Spatio Temporal Data | Spatio Temporal Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a gitbook for spatio temporal analysis." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Exploring Spatio Temporal Data | Spatio Temporal Statistics" />
  
  <meta name="twitter:description" content="This is a gitbook for spatio temporal analysis." />
  

<meta name="author" content="BoHyun Shin" />


<meta name="date" content="2020-07-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="mapping-spatio-temporal-data.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatio Temporal Gitbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Being Familiar with STD</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Exploring Spatio Temporal Data</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#representation-of-spatio-temporal-data-in-r"><i class="fa fa-check"></i><b>1.1</b> Representation of Spatio Temporal Data in R</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#visualization-of-std"><i class="fa fa-check"></i><b>1.2</b> Visualization of STD</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exploratory-analysis-of-std"><i class="fa fa-check"></i><b>1.3</b> Exploratory Analysis of STD</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#empirical-spatial-means-and-covariances"><i class="fa fa-check"></i><b>1.3.1</b> Empirical Spatial Means and Covariances</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#elements-of-point-referenced-modeling"><i class="fa fa-check"></i><b>1.3.2</b> Elements of point-referenced modeling</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#empirical-orthogonal-functions-eofs"><i class="fa fa-check"></i><b>1.3.3</b> Empirical Orthogonal Functions (EOFs)</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#wrap-up"><i class="fa fa-check"></i><b>1.4</b> Wrap up</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mapping-spatio-temporal-data.html"><a href="mapping-spatio-temporal-data.html"><i class="fa fa-check"></i><b>2</b> 02- Mapping Spatio Temporal Data</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatio Temporal Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Exploring Spatio Temporal Data</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="intro.html#cb1-1"></a><span class="kw">library</span>(<span class="st">&quot;animation&quot;</span>)</span>
<span id="cb1-2"><a href="intro.html#cb1-2"></a><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-3"><a href="intro.html#cb1-3"></a><span class="kw">library</span>(<span class="st">&quot;tidyr&quot;</span>)</span>
<span id="cb1-4"><a href="intro.html#cb1-4"></a><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb1-5"><a href="intro.html#cb1-5"></a><span class="kw">library</span>(<span class="st">&quot;gstat&quot;</span>)</span>
<span id="cb1-6"><a href="intro.html#cb1-6"></a><span class="kw">library</span>(<span class="st">&quot;maps&quot;</span>)</span>
<span id="cb1-7"><a href="intro.html#cb1-7"></a><span class="kw">library</span>(<span class="st">&quot;STRbook&quot;</span>)</span>
<span id="cb1-8"><a href="intro.html#cb1-8"></a><span class="kw">library</span>(<span class="st">&quot;grid&quot;</span>)</span>
<span id="cb1-9"><a href="intro.html#cb1-9"></a><span class="kw">library</span>(<span class="st">&quot;gridExtra&quot;</span>)</span>
<span id="cb1-10"><a href="intro.html#cb1-10"></a><span class="kw">library</span>(<span class="st">&quot;CCA&quot;</span>)</span>
<span id="cb1-11"><a href="intro.html#cb1-11"></a><span class="kw">library</span>(<span class="st">&quot;sp&quot;</span>)</span>
<span id="cb1-12"><a href="intro.html#cb1-12"></a><span class="kw">library</span>(<span class="st">&quot;spacetime&quot;</span>)</span></code></pre></div>
<p>In this part, we will have a look at some basics about STD before applying statistical models. This includes calculating basic statistics, visualizing map etc.
This section is largely based on the Spatio-Temporal Statistics with R, Cressie. So, if you want to know the details, please refer to it.</p>
<div id="representation-of-spatio-temporal-data-in-r" class="section level2">
<h2><span class="header-section-number">1.1</span> Representation of Spatio Temporal Data in R</h2>
<p>Although there are many ways to represent spatial data or time series data in R, there are relatively few ways to represent the STD in R. In this book, we will use the class defined in the R package <strong>spacetime</strong>. Classes defined in this package extend <strong>sp</strong> classs for spatial data and <strong>xts</strong> class for time series data.<br />
Some simple tables can represent the STD as following three classes:</p>
<ul>
<li>time-wide, where columns correspond to different time points</li>
<li>space-wird, where columns correspond to different spatial features (e.g., locations, regions, grid points)</li>
<li>long formats, where each record corresponds to a specific time and space coordinate</li>
</ul>
<p>Objects in <strong>spacetime</strong> offer some additional information such as the map projection, time zone or polygon boundaries where lattice data are defined.</p>
<p>Pebesma (2012) considers four classes of space-time data:</p>
<ul>
<li>full grid (STF), a combination of any sp object and any xts object to represent all possible locations on the implied space-time lattice;</li>
<li>sparse grid (STS), as STF, but contains only the non-missing space-time combina- tions on a space-time lattice;</li>
<li>irregular (STI), an irregular space-time data structure, where each point is allocated a spatial coordinate and a time stamp;</li>
<li>simple trajectories (STT), a sequence of space-time points that form trajectories.</li>
</ul>
</div>
<div id="visualization-of-std" class="section level2">
<h2><span class="header-section-number">1.2</span> Visualization of STD</h2>
<p>There are some basic ways to visualize STD. We will see them briefly.<br />
<strong>Spatial Plots</strong> First of all, for fixed time point, plots of covariate of interest can be plotted with longitude and latitude. Moreover, we can vary the time point to see some pattern in specific location. Below is the example figure that shows max temperature according to the different data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="intro.html#cb2-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-2"><a href="intro.html#cb2-2"></a></span>
<span id="cb2-3"><a href="intro.html#cb2-3"></a><span class="co">## ----message=FALSE, warning = FALSE--------------------------------------</span></span>
<span id="cb2-4"><a href="intro.html#cb2-4"></a><span class="kw">data</span>(<span class="st">&quot;NOAA_df_1990&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;STRbook&quot;</span>)</span>
<span id="cb2-5"><a href="intro.html#cb2-5"></a>Tmax &lt;-<span class="st"> </span><span class="kw">filter</span>(NOAA_df_<span class="dv">1990</span>,     <span class="co"># subset the data</span></span>
<span id="cb2-6"><a href="intro.html#cb2-6"></a>              proc <span class="op">==</span><span class="st"> &quot;Tmax&quot;</span> <span class="op">&amp;</span><span class="st">   </span><span class="co"># only max temperature</span></span>
<span id="cb2-7"><a href="intro.html#cb2-7"></a><span class="st">              </span>month <span class="op">%in%</span><span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">9</span> <span class="op">&amp;</span><span class="st">   </span><span class="co"># May to September</span></span>
<span id="cb2-8"><a href="intro.html#cb2-8"></a><span class="st">              </span>year <span class="op">==</span><span class="st"> </span><span class="dv">1993</span>)      <span class="co"># year of 1993</span></span>
<span id="cb2-9"><a href="intro.html#cb2-9"></a></span>
<span id="cb2-10"><a href="intro.html#cb2-10"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb2-11"><a href="intro.html#cb2-11"></a>Tmax <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lon, lat, date, julian, z) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>##         lon   lat       date julian  z
## 1 -81.43333 39.35 1993-05-01 728050 82
## 2 -81.43333 39.35 1993-05-02 728051 84
## 3 -81.43333 39.35 1993-05-03 728052 79
## 4 -81.43333 39.35 1993-05-04 728053 72
## 5 -81.43333 39.35 1993-05-05 728054 73
## 6 -81.43333 39.35 1993-05-06 728055 78</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="intro.html#cb4-1"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb4-2"><a href="intro.html#cb4-2"></a>Tmax<span class="op">$</span>t &lt;-<span class="st"> </span>Tmax<span class="op">$</span>julian <span class="op">-</span><span class="st"> </span><span class="dv">728049</span>     <span class="co"># create a new time variable</span></span>
<span id="cb4-3"><a href="intro.html#cb4-3"></a></span>
<span id="cb4-4"><a href="intro.html#cb4-4"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb4-5"><a href="intro.html#cb4-5"></a>Tmax_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">subset</span>(Tmax, t <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">30</span>))  <span class="co"># extract data</span></span>
<span id="cb4-6"><a href="intro.html#cb4-6"></a></span>
<span id="cb4-7"><a href="intro.html#cb4-7"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb4-8"><a href="intro.html#cb4-8"></a>NOAA_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(Tmax_<span class="dv">1</span>) <span class="op">+</span><span class="st">             </span><span class="co"># plot points</span></span>
<span id="cb4-9"><a href="intro.html#cb4-9"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lon,<span class="dt">y =</span> lat,       <span class="co"># lon and lat</span></span>
<span id="cb4-10"><a href="intro.html#cb4-10"></a>                   <span class="dt">colour =</span> z),           <span class="co"># attribute color</span></span>
<span id="cb4-11"><a href="intro.html#cb4-11"></a>               <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st">                </span><span class="co"># make all points larger</span></span>
<span id="cb4-12"><a href="intro.html#cb4-12"></a><span class="st">    </span><span class="kw">col_scale</span>(<span class="dt">name =</span> <span class="st">&quot;degF&quot;</span>) <span class="op">+</span><span class="st">            </span><span class="co"># attach color scale</span></span>
<span id="cb4-13"><a href="intro.html#cb4-13"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Longitude (deg)&quot;</span>) <span class="op">+</span><span class="st">             </span><span class="co"># x-axis label</span></span>
<span id="cb4-14"><a href="intro.html#cb4-14"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Latitude (deg)&quot;</span>) <span class="op">+</span><span class="st">              </span><span class="co"># y-axis label</span></span>
<span id="cb4-15"><a href="intro.html#cb4-15"></a><span class="st">    </span><span class="kw">geom_path</span>(<span class="dt">data =</span> <span class="kw">map_data</span>(<span class="st">&quot;state&quot;</span>),   <span class="co"># add US states map</span></span>
<span id="cb4-16"><a href="intro.html#cb4-16"></a>          <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span></span>
<span id="cb4-17"><a href="intro.html#cb4-17"></a><span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>date) <span class="op">+</span><span class="st">                   </span><span class="co"># facet by time</span></span>
<span id="cb4-18"><a href="intro.html#cb4-18"></a><span class="st">    </span><span class="kw">coord_fixed</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">105</span>, <span class="dv">-75</span>),</span>
<span id="cb4-19"><a href="intro.html#cb4-19"></a>                <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">50</span>))  <span class="op">+</span><span class="st">      </span><span class="co"># zoom in</span></span>
<span id="cb4-20"><a href="intro.html#cb4-20"></a><span class="st">    </span><span class="kw">theme_bw</span>()                            <span class="co"># B&amp;W theme</span></span>
<span id="cb4-21"><a href="intro.html#cb4-21"></a>NOAA_plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:nice-fig"></span>
<img src="bookdown-demo_files/figure-html/nice-fig-1.png" alt="Here is a nice figure!" width="80%" />
<p class="caption">
Figure 1.1: Here is a nice figure!
</p>
</div>
<p><strong>Time Series plots</strong> For fixed location, time series plots which show some trend in variable can be plotted. Below is the example figure that shows max temperature for randomly selected 10 stations according to the days</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="intro.html#cb5-1"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb5-2"><a href="intro.html#cb5-2"></a>UIDs &lt;-<span class="st"> </span><span class="kw">unique</span>(Tmax<span class="op">$</span>id)                     <span class="co"># extract IDs</span></span>
<span id="cb5-3"><a href="intro.html#cb5-3"></a>UIDs_sub &lt;-<span class="st"> </span><span class="kw">sample</span>(UIDs, <span class="dv">10</span>)                <span class="co"># sample 10 IDs</span></span>
<span id="cb5-4"><a href="intro.html#cb5-4"></a>Tmax_sub &lt;-<span class="st"> </span><span class="kw">filter</span>(Tmax, id <span class="op">%in%</span><span class="st"> </span>UIDs_sub)  <span class="co"># subset data</span></span>
<span id="cb5-5"><a href="intro.html#cb5-5"></a></span>
<span id="cb5-6"><a href="intro.html#cb5-6"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb5-7"><a href="intro.html#cb5-7"></a>TmaxTS &lt;-<span class="st"> </span><span class="kw">ggplot</span>(Tmax_sub) <span class="op">+</span></span>
<span id="cb5-8"><a href="intro.html#cb5-8"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> t, <span class="dt">y =</span> z)) <span class="op">+</span><span class="st"> </span><span class="co"># line plot of z against t</span></span>
<span id="cb5-9"><a href="intro.html#cb5-9"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id, <span class="dt">ncol =</span> <span class="dv">5</span>) <span class="op">+</span><span class="st">    </span><span class="co"># facet by station</span></span>
<span id="cb5-10"><a href="intro.html#cb5-10"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Day number (days)&quot;</span>) <span class="op">+</span><span class="st">    </span><span class="co"># x label</span></span>
<span id="cb5-11"><a href="intro.html#cb5-11"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Tmax (degF)&quot;</span>) <span class="op">+</span><span class="st">          </span><span class="co"># y label</span></span>
<span id="cb5-12"><a href="intro.html#cb5-12"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">                   </span><span class="co"># BW theme</span></span>
<span id="cb5-13"><a href="intro.html#cb5-13"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.spacing =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;lines&quot;</span>)) <span class="co"># facet spacing</span></span>
<span id="cb5-14"><a href="intro.html#cb5-14"></a>TmaxTS</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-2-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p><strong>Hovmoller Plots</strong> This is the two dimensional plot with space-time visualization where space is collapsed onto one dimension. That is, traditionally, space is identified with longitude, latitude but in Hovmoller plots, not both of them not one of them is used. Below is ths Hovmoller plots for the longitude and latitude for the Tmax variable in NOAA data set. Note that as increasing latitude, the temperature goes down. This implies that we may include the interation effect with the time and latitude variable.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="intro.html#cb6-1"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb6-2"><a href="intro.html#cb6-2"></a>lim_lat &lt;-<span class="st"> </span><span class="kw">range</span>(Tmax<span class="op">$</span>lat)        <span class="co"># latitude range</span></span>
<span id="cb6-3"><a href="intro.html#cb6-3"></a>lim_t &lt;-<span class="st"> </span><span class="kw">range</span>(Tmax<span class="op">$</span>t)            <span class="co"># time range</span></span>
<span id="cb6-4"><a href="intro.html#cb6-4"></a>lat_axis &lt;-<span class="st"> </span><span class="kw">seq</span>(lim_lat[<span class="dv">1</span>],       <span class="co"># latitude axis</span></span>
<span id="cb6-5"><a href="intro.html#cb6-5"></a>                lim_lat[<span class="dv">2</span>],</span>
<span id="cb6-6"><a href="intro.html#cb6-6"></a>                <span class="dt">length=</span><span class="dv">25</span>)</span>
<span id="cb6-7"><a href="intro.html#cb6-7"></a>t_axis &lt;-<span class="st"> </span><span class="kw">seq</span>(lim_t[<span class="dv">1</span>],           <span class="co"># time axis</span></span>
<span id="cb6-8"><a href="intro.html#cb6-8"></a>              lim_t[<span class="dv">2</span>],</span>
<span id="cb6-9"><a href="intro.html#cb6-9"></a>              <span class="dt">length=</span><span class="dv">100</span>)</span>
<span id="cb6-10"><a href="intro.html#cb6-10"></a>lat_t_grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">lat =</span> lat_axis,</span>
<span id="cb6-11"><a href="intro.html#cb6-11"></a>                          <span class="dt">t =</span> t_axis)</span>
<span id="cb6-12"><a href="intro.html#cb6-12"></a></span>
<span id="cb6-13"><a href="intro.html#cb6-13"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb6-14"><a href="intro.html#cb6-14"></a>Tmax_grid &lt;-<span class="st"> </span>Tmax</span>
<span id="cb6-15"><a href="intro.html#cb6-15"></a>dists &lt;-<span class="st"> </span><span class="kw">abs</span>(<span class="kw">outer</span>(Tmax<span class="op">$</span>lat, lat_axis, <span class="st">&quot;-&quot;</span>))</span>
<span id="cb6-16"><a href="intro.html#cb6-16"></a>Tmax_grid<span class="op">$</span>lat &lt;-<span class="st"> </span>lat_axis[<span class="kw">apply</span>(dists, <span class="dv">1</span>, which.min)]</span>
<span id="cb6-17"><a href="intro.html#cb6-17"></a></span>
<span id="cb6-18"><a href="intro.html#cb6-18"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb6-19"><a href="intro.html#cb6-19"></a>Tmax_lat_Hov &lt;-<span class="st"> </span><span class="kw">group_by</span>(Tmax_grid, lat, t) <span class="op">%&gt;%</span></span>
<span id="cb6-20"><a href="intro.html#cb6-20"></a><span class="st">                </span><span class="kw">summarise</span>(<span class="dt">z =</span> <span class="kw">mean</span>(z))</span>
<span id="cb6-21"><a href="intro.html#cb6-21"></a></span>
<span id="cb6-22"><a href="intro.html#cb6-22"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb6-23"><a href="intro.html#cb6-23"></a>Hovmoller_lat &lt;-<span class="st"> </span><span class="kw">ggplot</span>(Tmax_lat_Hov) <span class="op">+</span><span class="st">            </span><span class="co"># take data</span></span>
<span id="cb6-24"><a href="intro.html#cb6-24"></a><span class="st">        </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lat, <span class="dt">y =</span> t, <span class="dt">fill =</span> z)) <span class="op">+</span><span class="st"> </span><span class="co"># plot</span></span>
<span id="cb6-25"><a href="intro.html#cb6-25"></a><span class="st">        </span><span class="kw">fill_scale</span>(<span class="dt">name =</span> <span class="st">&quot;degF&quot;</span>) <span class="op">+</span><span class="st">     </span><span class="co"># add color scale</span></span>
<span id="cb6-26"><a href="intro.html#cb6-26"></a><span class="st">        </span><span class="kw">scale_y_reverse</span>() <span class="op">+</span><span class="st">             </span><span class="co"># rev y scale</span></span>
<span id="cb6-27"><a href="intro.html#cb6-27"></a><span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;Day number (days)&quot;</span>) <span class="op">+</span><span class="st">     </span><span class="co"># add y label</span></span>
<span id="cb6-28"><a href="intro.html#cb6-28"></a><span class="st">        </span><span class="kw">xlab</span>(<span class="st">&quot;Latitude (degrees)&quot;</span>) <span class="op">+</span><span class="st">    </span><span class="co"># add x label</span></span>
<span id="cb6-29"><a href="intro.html#cb6-29"></a><span class="st">        </span><span class="kw">theme_bw</span>()                      <span class="co"># change theme</span></span>
<span id="cb6-30"><a href="intro.html#cb6-30"></a>Hovmoller_lat</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-3-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="exploratory-analysis-of-std" class="section level2">
<h2><span class="header-section-number">1.3</span> Exploratory Analysis of STD</h2>
<p>In this section, we consider some basic statistics for exploratory analysis of STD. Specifically, empirical means, empirical coavariances, spatio-temporal covariograms, semivariograms will be covered and the use of empirical orthogonal functions and their associated principal-component time series, and spatio-temporal canonical correlation analysis will be considered.</p>
<div id="empirical-spatial-means-and-covariances" class="section level3">
<h3><span class="header-section-number">1.3.1</span> Empirical Spatial Means and Covariances</h3>
<p>Assume that we have observations <span class="math inline">\(Z(\mathbf{s}_i ; t_j)\)</span> for spatial locations <span class="math inline">\(\{ \mathbf{s}_i: \; i=1, \cdots, m \}\)</span> and times <span class="math inline">\(\{ t_j: \; j=1, \cdots, T \}\)</span>. The empirical spatial mean for location <span class="math inline">\(\mathbf{s}_i\)</span>, <span class="math inline">\(\hat{\mu}_{z,s} (\mathbf{s}_i)\)</span> is then found by averaging over time:</p>
<p><span class="math display">\[\begin{equation}
\hat{\mu}_{z,s} (\mathbf{s}_i) \equiv \dfrac1T \sum^T_{j=1} Z(\mathbf{s}_i; t_j) \tag{1}
\end{equation}\]</span></p>
<p>For <span class="math inline">\(m\)</span> spatial locations, we assume there are equally <span class="math inline">\(T\)</span> time stamps in (1). This can be extended to <span class="math inline">\(m\)</span> dimensional vector. Note that for unbalanced time stamps, <span class="math inline">\(T\)</span> is changed to <span class="math inline">\(T_i\)</span> where index <span class="math inline">\(i\)</span> denotes the location.<br />
Likewise, one can average across space for fixed time point <span class="math inline">\(t_j\)</span>. That is</p>
<p><span class="math display">\[\begin{equation}
\hat{\mu}_{z,t} (t_j) \equiv \dfrac1m \sum^m_{i=1} Z(\mathbf{s}_i;t_j) \tag2
\end{equation}\]</span></p>
<p>Through empirical means, we can get some useful insights regarding STD, e.g.,</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="intro.html#cb7-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>) </span>
<span id="cb7-2"><a href="intro.html#cb7-2"></a></span>
<span id="cb7-3"><a href="intro.html#cb7-3"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb7-4"><a href="intro.html#cb7-4"></a><span class="kw">data</span>(<span class="st">&quot;NOAA_df_1990&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;STRbook&quot;</span>)</span>
<span id="cb7-5"><a href="intro.html#cb7-5"></a>Tmax &lt;-<span class="st"> </span><span class="kw">filter</span>(NOAA_df_<span class="dv">1990</span>,     <span class="co"># subset the data</span></span>
<span id="cb7-6"><a href="intro.html#cb7-6"></a>              proc <span class="op">==</span><span class="st"> &quot;Tmax&quot;</span> <span class="op">&amp;</span><span class="st">   </span><span class="co"># only max temperature</span></span>
<span id="cb7-7"><a href="intro.html#cb7-7"></a><span class="st">              </span>month <span class="op">%in%</span><span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">9</span> <span class="op">&amp;</span><span class="st">   </span><span class="co"># May to September</span></span>
<span id="cb7-8"><a href="intro.html#cb7-8"></a><span class="st">              </span>year <span class="op">==</span><span class="st"> </span><span class="dv">1993</span>)      <span class="co"># year of 1993</span></span>
<span id="cb7-9"><a href="intro.html#cb7-9"></a>Tmax<span class="op">$</span>t &lt;-<span class="st"> </span>Tmax<span class="op">$</span>julian <span class="op">-</span><span class="st"> </span><span class="dv">728049</span>   <span class="co"># create a new time variable</span></span>
<span id="cb7-10"><a href="intro.html#cb7-10"></a></span>
<span id="cb7-11"><a href="intro.html#cb7-11"></a><span class="co">## -----------------------------------------------------------</span></span>
<span id="cb7-12"><a href="intro.html#cb7-12"></a>spat_av &lt;-<span class="st"> </span><span class="kw">group_by</span>(Tmax, lat, lon) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># group by lon-lat</span></span>
<span id="cb7-13"><a href="intro.html#cb7-13"></a><span class="st">           </span><span class="kw">summarise</span>(<span class="dt">mu_emp =</span> <span class="kw">mean</span>(z))     <span class="co"># mean for each lon-lat</span></span>
<span id="cb7-14"><a href="intro.html#cb7-14"></a><span class="kw">head</span>(spat_av)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   lat [6]
##     lat   lon mu_emp
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  32.1 -81.2   91.0
## 2  32.2 -98.2   88.9
## 3  32.3 -86.4   91.2
## 4  32.3 -90.1   89.5
## 5  32.3 -88.8   90.1
## 6  32.4 -99.7   90.4</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="intro.html#cb9-1"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb9-2"><a href="intro.html#cb9-2"></a>lat_means &lt;-<span class="st"> </span><span class="kw">ggplot</span>(spat_av) <span class="op">+</span></span>
<span id="cb9-3"><a href="intro.html#cb9-3"></a><span class="st">             </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(lat, mu_emp)) <span class="op">+</span></span>
<span id="cb9-4"><a href="intro.html#cb9-4"></a><span class="st">             </span><span class="kw">xlab</span>(<span class="st">&quot;Latitude (deg)&quot;</span>) <span class="op">+</span></span>
<span id="cb9-5"><a href="intro.html#cb9-5"></a><span class="st">             </span><span class="kw">ylab</span>(<span class="st">&quot;Maximum temperature (degF)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span>
<span id="cb9-6"><a href="intro.html#cb9-6"></a>lon_means &lt;-<span class="st"> </span><span class="kw">ggplot</span>(spat_av) <span class="op">+</span></span>
<span id="cb9-7"><a href="intro.html#cb9-7"></a><span class="st">             </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(lon, mu_emp)) <span class="op">+</span></span>
<span id="cb9-8"><a href="intro.html#cb9-8"></a><span class="st">             </span><span class="kw">xlab</span>(<span class="st">&quot;Longitude (deg)&quot;</span>) <span class="op">+</span></span>
<span id="cb9-9"><a href="intro.html#cb9-9"></a><span class="st">             </span><span class="kw">ylab</span>(<span class="st">&quot;Maximum temperature (degF)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span>
<span id="cb9-10"><a href="intro.html#cb9-10"></a><span class="kw">grid.arrange</span>(lat_means, lon_means, <span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-4-1.png" width="672" />
Note that for latitude, as latitude decreases, the empirical mean of max temperature, which is grouped by latitude and longitude, increases.</p>
<p>It is often useful to consider the empirical spatial covariability in STD. Between two spatial locations <span class="math inline">\(\mathbf{s}_i, \mathbf{s}_k\)</span>, the empirical lag-<span class="math inline">\(\tau\)</span> covariance is defined by</p>
<p><span class="math display">\[\begin{equation}
  \hat{C}^{(\tau)}_z (\mathbf{s}_i, \mathbf{s}_k) \equiv \dfrac1{T-\tau} \sum^T_{j=\tau+1} ( Z(\mathbf{s}_i; t_j) - \hat{\mu}_{z,s}(\mathbf{s}_i)  )( Z(\mathbf{s}_k; t_j - \tau) - \hat{\mu}_{z,s}(\mathbf{s}_k)  ) \tag3
\end{equation}\]</span></p>
<p>If we consider <span class="math inline">\(m\)</span> locations, the covariability will become covariance matrix, with <span class="math inline">\(m \times m\)</span> dimension. In general, it is difficult to gain insight from this matrix. But one can sometimes get insights by splitting the domain into “strips” corresponding to one of the spatial dimensions and then plotting the covariance matrix for those strips.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="intro.html#cb10-1"></a>lm1 &lt;-<span class="st"> </span><span class="kw">lm</span>(z <span class="op">~</span><span class="st"> </span>lat <span class="op">+</span><span class="st"> </span>t <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(t<span class="op">^</span><span class="dv">2</span>), <span class="dt">data =</span> Tmax) <span class="co"># fit a linear model</span></span>
<span id="cb10-2"><a href="intro.html#cb10-2"></a>Tmax<span class="op">$</span>residuals &lt;-<span class="st"> </span><span class="kw">residuals</span>(lm1)             <span class="co"># store the residuals</span></span>
<span id="cb10-3"><a href="intro.html#cb10-3"></a></span>
<span id="cb10-4"><a href="intro.html#cb10-4"></a>spat_df &lt;-<span class="st"> </span><span class="kw">filter</span>(Tmax, t <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># lon/lat coords of stations</span></span>
<span id="cb10-5"><a href="intro.html#cb10-5"></a><span class="st">            </span><span class="kw">select</span>(lon, lat)  <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># select lon/lat only</span></span>
<span id="cb10-6"><a href="intro.html#cb10-6"></a><span class="st">            </span><span class="kw">arrange</span>(lon, lat)       <span class="co"># sort ascending by lon/lat</span></span>
<span id="cb10-7"><a href="intro.html#cb10-7"></a>m &lt;-<span class="st"> </span><span class="kw">nrow</span>(spat_av)                  <span class="co"># number of stations</span></span>
<span id="cb10-8"><a href="intro.html#cb10-8"></a></span>
<span id="cb10-9"><a href="intro.html#cb10-9"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb10-10"><a href="intro.html#cb10-10"></a>X &lt;-<span class="st"> </span><span class="kw">select</span>(Tmax, lon, lat, residuals, t) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># select columns</span></span>
<span id="cb10-11"><a href="intro.html#cb10-11"></a><span class="st">     </span><span class="kw">spread</span>(t, residuals) <span class="op">%&gt;%</span><span class="st">                 </span><span class="co"># make time-wide</span></span>
<span id="cb10-12"><a href="intro.html#cb10-12"></a><span class="st">     </span><span class="kw">select</span>(<span class="op">-</span>lon, <span class="op">-</span>lat) <span class="op">%&gt;%</span><span class="st">                   </span><span class="co"># drop coord info</span></span>
<span id="cb10-13"><a href="intro.html#cb10-13"></a><span class="st">     </span><span class="kw">t</span>()                                      <span class="co"># make space-wide</span></span>
<span id="cb10-14"><a href="intro.html#cb10-14"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb10-15"><a href="intro.html#cb10-15"></a>Lag0_cov &lt;-<span class="st"> </span><span class="kw">cov</span>(X, <span class="dt">use =</span> <span class="st">&#39;complete.obs&#39;</span>)</span>
<span id="cb10-16"><a href="intro.html#cb10-16"></a>Lag1_cov &lt;-<span class="st"> </span><span class="kw">cov</span>(X[<span class="op">-</span><span class="dv">1</span>, ], X[<span class="op">-</span><span class="kw">nrow</span>(X),], <span class="dt">use =</span> <span class="st">&#39;complete.obs&#39;</span>)</span>
<span id="cb10-17"><a href="intro.html#cb10-17"></a></span>
<span id="cb10-18"><a href="intro.html#cb10-18"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb10-19"><a href="intro.html#cb10-19"></a>spat_df<span class="op">$</span>n &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(spat_df)    <span class="co"># assign an index to each station</span></span>
<span id="cb10-20"><a href="intro.html#cb10-20"></a>lim_lon &lt;-<span class="st"> </span><span class="kw">range</span>(spat_df<span class="op">$</span>lon)   <span class="co"># range of lon coordinates</span></span>
<span id="cb10-21"><a href="intro.html#cb10-21"></a>lon_strips &lt;-<span class="st"> </span><span class="kw">seq</span>(lim_lon[<span class="dv">1</span>],   <span class="co"># create 4 long. strip boundaries</span></span>
<span id="cb10-22"><a href="intro.html#cb10-22"></a>                  lim_lon[<span class="dv">2</span>],</span>
<span id="cb10-23"><a href="intro.html#cb10-23"></a>                  <span class="dt">length =</span> <span class="dv">5</span>)</span>
<span id="cb10-24"><a href="intro.html#cb10-24"></a>spat_df<span class="op">$</span>lon_strip &lt;-<span class="st"> </span><span class="kw">cut</span>(spat_df<span class="op">$</span>lon,     <span class="co"># bin the lon into</span></span>
<span id="cb10-25"><a href="intro.html#cb10-25"></a>                         lon_strips,      <span class="co"># their respective bins</span></span>
<span id="cb10-26"><a href="intro.html#cb10-26"></a>                         <span class="dt">labels =</span> <span class="ot">FALSE</span>,  <span class="co"># don&#39;t assign labels</span></span>
<span id="cb10-27"><a href="intro.html#cb10-27"></a>                         <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>) <span class="co"># include edges</span></span>
<span id="cb10-28"><a href="intro.html#cb10-28"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb10-29"><a href="intro.html#cb10-29"></a><span class="kw">head</span>(spat_df)   <span class="co"># print the first 6 records of spat_df</span></span></code></pre></div>
<pre><code>##         lon      lat n lon_strip
## 1 -99.96667 37.76667 1         1
## 2 -99.76667 36.30000 2         1
## 3 -99.68333 32.43333 3         1
## 4 -99.05000 35.00000 4         1
## 5 -98.81667 38.86666 5         1
## 6 -98.51667 33.98333 6         1</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="intro.html#cb12-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb12-2"><a href="intro.html#cb12-2"></a><span class="kw">plot_cov_strips</span>(Lag0_cov, spat_df)  <span class="co"># plot the lag-0 matrices</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="intro.html#cb13-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb13-2"><a href="intro.html#cb13-2"></a><span class="kw">plot_cov_strips</span>(Lag1_cov, spat_df)  <span class="co"># plot the lag-1 matrices</span></span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
<p>Note that there is some spatial dependence in the plots, where spatial covariance decreases as latitude decreases.<br />
We can also calculate lag-<span class="math inline">\(\tau\)</span> cross covariance between two different data, i.e., <span class="math inline">\({\mathbf{Z}_{t_j}}, {\mathbf{X}_{t_j}}\)</span></p>
</div>
<div id="elements-of-point-referenced-modeling" class="section level3">
<h3><span class="header-section-number">1.3.2</span> Elements of point-referenced modeling</h3>
<p>Before dive into the point-referenced modeling, let’s define some basic elements required for modeling</p>
<p><strong>strictly stationairty</strong><br />
if distribution of <span class="math inline">\((Y(s_1), \cdots, Y(s_n))\)</span> is the same as that of <span class="math inline">\((Y(s_1 + h), \cdots, Y(s_n + h))\)</span></p>
<p><strong>weak stationairty</strong><br />
if <span class="math inline">\(\mu(s) \equiv \mu\)</span> (constant mean) and <span class="math inline">\(Cov(Y(s),Y(s+h))=C(h)\)</span></p>
<p><strong>intrinsic stationarity</strong><br />
<span class="math inline">\(E[Y(s+h) - Y(s)]^2 = Var(Y(s+h) - Y(s)) = 2\gamma(h)\)</span> (soley depends on <span class="math inline">\(h\)</span>)</p>
<p><strong>variograms</strong><br />
<span class="math inline">\(2\gamma(h)\)</span> in intrinsic stationarity definition</p>
<p><strong>semivariograms</strong><br />
<span class="math inline">\(\gamma(h)\)</span> in intrinsic stationarity definition</p>
<p><strong>Isotropy</strong><br />
if the semivariogram function <span class="math inline">\(\gamma(h)\)</span> depends upon only through its length <span class="math inline">\(||h||\)</span>, which is written as <span class="math inline">\(\gamma(||h||)\)</span></p>
<p><strong>Anisotropy</strong><br />
spatial process which is not isotropy</p>
<p><strong>covariagram</strong><br />
C(h) defined in weak stationarity</p>
<p>For spatio-temporal covariogram or semivariogram, we simply add the temporal index. For example, for spatio-temporal dataset, semivariogram is defined as <span class="math inline">\(\gamma(s_i,s_k;t_j,t_l) \equiv \dfrac12 Var(Z(s_i;t_j) - Z(s_k;t_l))\)</span>.</p>
<p><em>variogram viz</em> is not included yet.</p>
</div>
<div id="empirical-orthogonal-functions-eofs" class="section level3">
<h3><span class="header-section-number">1.3.3</span> Empirical Orthogonal Functions (EOFs)</h3>
<p>EOFs can reveal some spatial dependence underlying in spatio-temporal data. EOFs can be obtained from spectral decomposition of empirical covariance matrix or equivantly, singular value decomposition on centered data matrix. In this section, we get the EOFs through SD on covariance matrix. By the spectral decomposition on the lag-0 spatial covariance matrix,</p>
<p><span class="math display">\[\begin{equation}
  \hat{C}^{(0)}=\Psi \Lambda \Psi^{T} \tag{3}
\end{equation}\]</span></p>
<p>The eigenvectors in <span class="math inline">\(\Psi\)</span> defined in (3) are called EOFs which are often plotted as spatial maps. Also, for <span class="math inline">\(k=1, \cdots, m\)</span>, the <span class="math inline">\(k\)</span>th principal component (PC) time series are given by <span class="math inline">\(a_k(t_j) \equiv \psi^{&#39;}_kZ_{t_j}\)</span>. Below are the figures that show the first two EOFs. Note that there is a clear pattern in center and eastern region. At that time, this pattern was matched with the EL Nino and La Nina.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="intro.html#cb14-1"></a><span class="kw">data</span>(<span class="st">&quot;SSTlandmask&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;STRbook&quot;</span>)</span>
<span id="cb14-2"><a href="intro.html#cb14-2"></a><span class="kw">data</span>(<span class="st">&quot;SSTlonlat&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;STRbook&quot;</span>)</span>
<span id="cb14-3"><a href="intro.html#cb14-3"></a><span class="kw">data</span>(<span class="st">&quot;SSTdata&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;STRbook&quot;</span>)</span>
<span id="cb14-4"><a href="intro.html#cb14-4"></a></span>
<span id="cb14-5"><a href="intro.html#cb14-5"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb14-6"><a href="intro.html#cb14-6"></a>delete_rows &lt;-<span class="st"> </span><span class="kw">which</span>(SSTlandmask <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb14-7"><a href="intro.html#cb14-7"></a>SSTdata &lt;-<span class="st"> </span>SSTdata[<span class="op">-</span>delete_rows, <span class="dv">1</span><span class="op">:</span><span class="dv">396</span>]</span>
<span id="cb14-8"><a href="intro.html#cb14-8"></a></span>
<span id="cb14-9"><a href="intro.html#cb14-9"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb14-10"><a href="intro.html#cb14-10"></a><span class="co">## Put data into space-wide form</span></span>
<span id="cb14-11"><a href="intro.html#cb14-11"></a>Z &lt;-<span class="st"> </span><span class="kw">t</span>(SSTdata)</span>
<span id="cb14-12"><a href="intro.html#cb14-12"></a><span class="kw">dim</span>(Z)</span></code></pre></div>
<pre><code>## [1]  396 2261</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="intro.html#cb16-1"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb16-2"><a href="intro.html#cb16-2"></a><span class="co">## First find the matrix we need to subtract:</span></span>
<span id="cb16-3"><a href="intro.html#cb16-3"></a>spat_mean &lt;-<span class="st"> </span><span class="kw">apply</span>(SSTdata, <span class="dv">1</span>, mean)</span>
<span id="cb16-4"><a href="intro.html#cb16-4"></a>nT &lt;-<span class="st"> </span><span class="kw">ncol</span>(SSTdata)</span>
<span id="cb16-5"><a href="intro.html#cb16-5"></a></span>
<span id="cb16-6"><a href="intro.html#cb16-6"></a><span class="co">## Then subtract and standardize:</span></span>
<span id="cb16-7"><a href="intro.html#cb16-7"></a>Zspat_detrend &lt;-<span class="st"> </span>Z <span class="op">-</span><span class="st"> </span><span class="kw">outer</span>(<span class="kw">rep</span>(<span class="dv">1</span>, nT), spat_mean)</span>
<span id="cb16-8"><a href="intro.html#cb16-8"></a>Zt &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(nT <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">*</span>Zspat_detrend</span>
<span id="cb16-9"><a href="intro.html#cb16-9"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb16-10"><a href="intro.html#cb16-10"></a>E &lt;-<span class="st"> </span><span class="kw">svd</span>(Zt) <span class="co"># svd on empirical covariance</span></span>
<span id="cb16-11"><a href="intro.html#cb16-11"></a></span>
<span id="cb16-12"><a href="intro.html#cb16-12"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb16-13"><a href="intro.html#cb16-13"></a>V &lt;-<span class="st"> </span>E<span class="op">$</span>v</span>
<span id="cb16-14"><a href="intro.html#cb16-14"></a><span class="kw">colnames</span>(E<span class="op">$</span>v) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;EOF&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(SSTdata)) <span class="co"># label columns</span></span>
<span id="cb16-15"><a href="intro.html#cb16-15"></a>EOFs &lt;-<span class="st"> </span><span class="kw">cbind</span>(SSTlonlat[<span class="op">-</span>delete_rows, ], E<span class="op">$</span>v)</span>
<span id="cb16-16"><a href="intro.html#cb16-16"></a><span class="kw">head</span>(EOFs[, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>])</span></code></pre></div>
<pre><code>##    lon lat         EOF1         EOF2        EOF3         EOF4
## 16 154 -29 -0.004915064 -0.012129566 -0.02882162 8.540892e-05
## 17 156 -29 -0.001412275 -0.002276177 -0.02552841 6.726077e-03
## 18 158 -29  0.000245909  0.002298082 -0.01933020 8.591251e-03
## 19 160 -29  0.001454972  0.002303585 -0.01905901 1.025538e-02
## 20 162 -29  0.002265778  0.001643138 -0.02251571 1.125295e-02
## 21 164 -29  0.003598762  0.003910823 -0.02311128 1.002285e-02</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="intro.html#cb18-1"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb18-2"><a href="intro.html#cb18-2"></a>TS &lt;-<span class="st"> </span><span class="kw">data.frame</span>(E<span class="op">$</span>u) <span class="op">%&gt;%</span><span class="st">            </span><span class="co"># convert U to data frame</span></span>
<span id="cb18-3"><a href="intro.html#cb18-3"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">t =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(E<span class="op">$</span>u)) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># add a time field</span></span>
<span id="cb18-4"><a href="intro.html#cb18-4"></a><span class="st">      </span><span class="kw">gather</span>(EOF, PC, <span class="op">-</span>t)            <span class="co"># put columns (except time)</span></span>
<span id="cb18-5"><a href="intro.html#cb18-5"></a>                                     <span class="co"># into long-table format with</span></span>
<span id="cb18-6"><a href="intro.html#cb18-6"></a>                                     <span class="co"># EOF-PC as key-value pair</span></span>
<span id="cb18-7"><a href="intro.html#cb18-7"></a></span>
<span id="cb18-8"><a href="intro.html#cb18-8"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb18-9"><a href="intro.html#cb18-9"></a>TS<span class="op">$</span>nPC &lt;-<span class="st"> </span>TS<span class="op">$</span>PC <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(nT<span class="dv">-1</span>)</span>
<span id="cb18-10"><a href="intro.html#cb18-10"></a><span class="co">## ------------------------------------------------------------------------</span></span>
<span id="cb18-11"><a href="intro.html#cb18-11"></a>firstEOF =<span class="st"> </span><span class="kw">ggplot</span>(EOFs) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">fill =</span> EOF1)) <span class="op">+</span></span>
<span id="cb18-12"><a href="intro.html#cb18-12"></a><span class="st">   </span><span class="kw">fill_scale</span>(<span class="dt">name =</span> <span class="st">&quot;degC&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb18-13"><a href="intro.html#cb18-13"></a><span class="st">   </span><span class="kw">xlab</span>(<span class="st">&quot;Longitude (deg)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Latitude (deg)&quot;</span>)</span>
<span id="cb18-14"><a href="intro.html#cb18-14"></a>secondEOF =<span class="st"> </span><span class="kw">ggplot</span>(EOFs) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">fill =</span> EOF2)) <span class="op">+</span></span>
<span id="cb18-15"><a href="intro.html#cb18-15"></a><span class="st">  </span><span class="kw">fill_scale</span>(<span class="dt">name =</span> <span class="st">&quot;degC&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb18-16"><a href="intro.html#cb18-16"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Longitude (deg)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Latitude (deg)&quot;</span>)</span>
<span id="cb18-17"><a href="intro.html#cb18-17"></a><span class="kw">grid.arrange</span>(firstEOF, secondEOF)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
</div>
<div id="wrap-up" class="section level2">
<h2><span class="header-section-number">1.4</span> Wrap up</h2>
<p>In this chapter, we learn about some basics spatio-temporal object used in R. Also, we talk some starting points before applying complex spatio-temporal model from mean, covariance aggregation to EOFs. After calculating these statistics, we visualize them for better understanding phenomenon. For more advanced exploratory spatio-temporal data analysis, we will take a close look at how to draw map, from defining various spatial object such as <strong>sp, SpatialPolygon</strong> to finally drawing desired map using <strong>tm</strong> package.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mapping-spatio-temporal-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-Exploring-Spatio-Temporal-Data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
